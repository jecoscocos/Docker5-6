# Todo List с Email функционалом

Проект содержит:
- Бэкенд на FastAPI
- Фронтенд на React
- База данных PostgreSQL
- Функционал отправки и получения писем через SMTP, IMAP и POP3

## Структура проекта

```
├── backend/         # Бэкенд на FastAPI
├── frontend/        # Фронтенд на React
└── database/        # Скрипты инициализации БД
```

## Первоначальная настройка

### 1. Настройте переменные окружения

Скопируйте файлы с шаблонами окружения и отредактируйте их (PowerShell):

```powershell
# В PowerShell
Copy-Item -Path "backend/.env.example" -Destination "backend/.env"
Copy-Item -Path "frontend/.env.example" -Destination "frontend/.env"
```

В файле `backend/.env` заполните учетные данные:
- Для почтовых протоколов (SMTP, IMAP, POP3)
- Для базы данных (POSTGRES_USER, POSTGRES_PASSWORD)

### 2. Запуск с помощью Docker

Для запуска всего приложения в PowerShell выполните:

```powershell
# Создание сети для коммуникаций между контейнерами
docker network create todo-network

# Запуск базы данных
docker build -t todo-db ./database
docker run -d --name todo-db --network todo-network `
  -e POSTGRES_DB=tododb `
  -e POSTGRES_USER=admin `
  -e POSTGRES_PASSWORD=admin123 `
  todo-db

# Запуск бэкенда
docker build -t todo-backend ./backend
docker run -d --name todo-backend --network todo-network -p 8000:8000 `
  -e POSTGRES_HOST=todo-db `
  -e POSTGRES_DB=tododb `
  -e POSTGRES_USER=admin `
  -e POSTGRES_PASSWORD=admin123 `
  todo-backend

# Запуск фронтенда
docker build -t todo-frontend ./frontend
docker run -d --name todo-frontend --network todo-network -p 3000:3000 `
  -e REACT_APP_API_URL=http://localhost:8000 `
  todo-frontend
```

После запуска приложение будет доступно по адресу: http://localhost:3000

## Функциональность

1. Создание, просмотр, редактирование и удаление задач
2. Отправка уведомлений по email
3. Просмотр входящих писем через протоколы IMAP и POP3

## Почтовые протоколы: SMTP, IMAP, POP3

### SMTP (Simple Mail Transfer Protocol)

**Назначение**: Протокол для отправки электронных писем.

**Особенности**:
- Работает по умолчанию на порту 25 (незащищенный), 587 (TLS/STARTTLS) или 465 (SSL/TLS)
- Отвечает только за отправку писем, не за их получение
- Устанавливает соединение с почтовым сервером получателя для доставки письма

**Основные команды**:
- `HELO/EHLO`: Представление клиента серверу
- `MAIL FROM`: Указание отправителя
- `RCPT TO`: Указание получателя
- `DATA`: Начало передачи содержимого письма
- `QUIT`: Завершение сессии

**Порядок работы**:
1. Установка соединения с SMTP-сервером
2. Авторизация (если требуется)
3. Отправка команд для передачи сообщения
4. Завершение сессии

### IMAP (Internet Message Access Protocol)

**Назначение**: Протокол для доступа к электронным письмам на сервере.

**Особенности**:
- Работает по умолчанию на порту 143 (незащищенный) или 993 (SSL/TLS)
- Хранит письма на сервере
- Позволяет работать с письмами с разных устройств, сохраняя их состояние (прочитано, с флагом и т.д.)
- Поддерживает работу в автономном режиме через кэширование
- Позволяет организовывать письма в папки на сервере

**Основные команды**:
- `LOGIN`: Авторизация на сервере
- `SELECT`: Выбор папки для работы
- `FETCH`: Получение писем или их частей
- `STORE`: Изменение флагов писем (прочитано, важное и т.д.)
- `SEARCH`: Поиск писем по критериям
- `LOGOUT`: Завершение сессии

**Порядок работы**:
1. Установка соединения с IMAP-сервером
2. Авторизация
3. Выбор папки
4. Выполнение команд для работы с письмами
5. Завершение сессии

### POP3 (Post Office Protocol version 3)

**Назначение**: Протокол для загрузки электронных писем с сервера на клиент.

**Особенности**:
- Работает по умолчанию на порту 110 (незащищенный) или 995 (SSL/TLS)
- По умолчанию загружает письма на клиент и удаляет их с сервера
- Простой протокол с ограниченной функциональностью
- Не хранит состояние писем на сервере
- Работа с почтой в основном происходит локально, на устройстве клиента

**Основные команды**:
- `USER/PASS`: Авторизация на сервере
- `LIST`: Получение списка писем
- `RETR`: Получение конкретного письма
- `DELE`: Пометка письма на удаление
- `QUIT`: Завершение сессии и фактическое удаление помеченных писем

**Порядок работы**:
1. Установка соединения с POP3-сервером
2. Авторизация
3. Получение списка доступных писем
4. Загрузка выбранных писем
5. Пометка загруженных писем на удаление (опционально)
6. Завершение сессии

### Сравнение IMAP и POP3

| Характеристика | IMAP | POP3 |
|----------------|------|------|
| Хранение писем | На сервере | На клиенте |
| Синхронизация | Полная, между устройствами | Нет |
| Работа с папками | Да | Нет |
| Сложность протокола | Выше | Ниже |
| Потребление трафика | Может быть оптимизировано | Загружает полное содержимое |
| Доступ к письмам | С любого устройства | Обычно с одного устройства |
| Требования к серверу | Выше (требуется хранить письма) | Ниже |

## WebSocket интеграция

В данной версии приложения добавлена поддержка WebSocket для обеспечения обновления задач в режиме реального времени.

### Принцип работы

- Сервер поддерживает список активных WebSocket соединений
- При любом изменении данных (создание, редактирование, удаление задачи) сервер отправляет уведомление всем подключенным клиентам
- Клиенты автоматически обновляют свой интерфейс при получении уведомлений
- Если соединение прерывается, клиент автоматически пытается переподключиться каждые 5 секунд

### Тестирование WebSocket

1. Запустите приложение
2. Откройте несколько вкладок/окон браузера с адресом `http://localhost:3000`
3. Внесите изменения в одном окне (добавление, редактирование или удаление задач)
4. Обратите внимание, что изменения автоматически отображаются во всех открытых окнах

### Отличия WebSocket от HTTP

- HTTP: запрос-ответ, соединение закрывается после ответа
- WebSocket: постоянное соединение, обмен сообщениями в реальном времени в обоих направлениях
- WebSocket позволяет серверу инициировать отправку данных клиенту
- WebSocket уменьшает задержки и снижает нагрузку на сервер за счет отсутствия повторного создания соединений

## Примечания по безопасности

1. Не коммитьте `.env` файлы в репозиторий
2. Для Gmail используйте пароли приложений вместо обычного пароля
3. Дополнительно убедитесь, что к вашим Docker-контейнерам нет публичного доступа 

# Настройка CI/CD с помощью GitHub Actions для Todo приложения

## Цель работы
Настроить непрерывную интеграцию и доставку (CI/CD) для приложения, автоматизировать процесс сборки контейнеров, тестирования и деплоя.

## Теоретическая часть

### Основы CI/CD

CI/CD (Непрерывная интеграция и непрерывная доставка) - это набор практик, направленных на автоматизацию процесса разработки и выпуска программного обеспечения.

**Непрерывная интеграция (CI)** обеспечивает автоматическую проверку кода при каждом коммите в репозиторий, запуская сборку и тесты. Это помогает рано выявлять проблемы и поддерживать стабильность кодовой базы.

**Непрерывная доставка (CD)** автоматизирует процесс выпуска новых версий приложения, подготавливая их к развертыванию.

### GitHub Actions

GitHub Actions - это сервис CI/CD, встроенный в GitHub. Основные преимущества:
- Тесная интеграция с GitHub
- Простота настройки с использованием YAML-файлов
- Широкие возможности настройки рабочих процессов
- Поддержка различных окружений и триггеров

### Примеры GitHub Actions для Docker

GitHub Actions удобен для работы с Docker, позволяя автоматизировать:
- Сборку Docker-образов
- Тестирование приложений внутри контейнеров
- Загрузку образов в реестры контейнеров (Docker Hub, GitHub Container Registry)
- Развертывание контейнеров в различных окружениях

## Ход выполнения

### 1. Создание GitHub Actions workflow

В рамках работы были созданы два workflow:

1. **Основной CI/CD workflow** (`.github/workflows/ci-cd.yml`) - запускается при каждом push или pull request в ветку main.
2. **Релизный workflow** (`.github/workflows/release.yml`) - запускается при создании тега с версией (v*.*.*)

Основные этапы каждого workflow:
1. Настройка окружения и создание Docker-сети
2. Сборка и запуск контейнеров (база данных, бэкенд, фронтенд)
3. Тестирование работоспособности сервисов через HTTP-запросы
4. Загрузка образов в Docker Hub
5. Очистка ресурсов

### 2. Сборка образов и тестирование

Workflow последовательно выполняет:
- Сборку трех Docker-образов (БД, бэкенд, фронтенд)
- Запуск контейнеров с правильной конфигурацией сети
- Проверку работоспособности бэкенда через запросы к API (GET /api/health, GET /tasks)
- Проверку доступности фронтенда

### 3. Загрузка образов в Docker Hub

После успешного тестирования образы загружаются в Docker Hub с использованием секретов репозитория для авторизации:
```yaml
- name: Авторизация в Docker Hub
  uses: docker/login-action@v2
  with:
    username: ${{ secrets.DOCKER_USERNAME }}
    password: ${{ secrets.DOCKER_PASSWORD }}

- name: Отправка образов в Docker Hub
  run: |
    docker push $BACKEND_IMAGE
    docker push $FRONTEND_IMAGE
    docker push $DATABASE_IMAGE
```

### 4. Особенности релизного workflow

Релизный workflow имеет следующие отличия от основного:
- Запускается только при создании Git-тега с версией (v*.*.*)
- Создает образы с тегами версии и latest
- Автоматически создает Release в GitHub с описанием изменений
- Пример команды для создания релиза:
  ```
  git tag v1.0.0
  git push origin v1.0.0
  ```

## Настройка для использования

1. Добавьте секреты в настройках репозитория GitHub:
   - `DOCKER_USERNAME` - имя пользователя на Docker Hub
   - `DOCKER_PASSWORD` - пароль или токен для Docker Hub

2. Убедитесь, что в бэкенде есть эндпоинт `/api/health` для проверки работоспособности

3. Запустите workflow одним из способов:
   - Внесите изменения и выполните push в ветку main (основной workflow)
   - Создайте pull request в ветку main (основной workflow)
   - Создайте и опубликуйте тег версии (релизный workflow)

## Преимущества настроенного CI/CD

1. **Автоматизация** - весь процесс от сборки до тестирования и публикации образов выполняется автоматически
2. **Быстрая обратная связь** - разработчики быстро узнают о проблемах с их изменениями
3. **Стандартизация процесса** - каждый релиз проходит одинаковые шаги проверки
4. **Экономия времени** - ручные операции по сборке и тестированию минимизированы
5. **Версионирование** - отдельный workflow для создания релизов с тегами версий 